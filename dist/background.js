chrome.alarms.onAlarm.addListener((e=>{console.log("Alarm triggered:",e.name),chrome.notifications.create({type:"basic",iconUrl:"/assets/note.png",title:"Alarm Triggered!",message:`Alarm "${e.name}" fired at ${(new Date).toLocaleTimeString()}`,silent:!1}),chrome.windows.create({url:chrome.runtime.getURL("alarm.html"),type:"popup",width:400,height:300})})),chrome.runtime.onInstalled.addListener((()=>{console.log("I Notes extension installed")})),chrome.runtime.onMessage.addListener(((e,o,r)=>{if("startGoogleLogin"===e.action){const e=process.env.GOOGLE_AUTH_CLIENT_ID,o=chrome.identity.getRedirectURL(),r=["profile","email"].join(" "),t=`https://accounts.google.com/o/oauth2/auth?client_id=${e}&response_type=token&redirect_uri=${encodeURIComponent(o)}&scope=${encodeURIComponent(r)}`;chrome.identity.launchWebAuthFlow({url:t,interactive:!0},(e=>{if(chrome.runtime.lastError||!e)return void console.error("Login failed:",chrome.runtime.lastError);const o=new URLSearchParams(e.split("#")[1]).get("access_token");o?fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${o}`}}).then((e=>e.json())).then((e=>{chrome.storage.local.set({userProfile:e},(()=>{console.log("User profile saved.")})),chrome.runtime.sendMessage({action:"refreshPopup"})})).catch((e=>{console.error("Failed to fetch user profile:",e)})):console.error("No access token found.")}))}}));